
## Основы программирования Arduino

Платы Arduino программируются на собственном языке программирования, но большая его часть заимоствована из языка C++. Любая программа написанная на языке C++ содержит одну или несколько функций. Одна из них обязательная и является точкой входа в программу - то есть выполняется при запуске.

*Функция в программировании — это подпрограмма (именованный участок программы, выполняющий определенные задачи), которую можно вызвать из другого места программы.* Функции в C++ обычно объявляются в формате:

```cpp
<тип возвращаемых данных> <имя функции> (<аргументы, передаваемые функции>)
{
    <команды, выполняемые в рамках функции> ;
    return <результат функции> ;
}
```
При этом каждое значение в <> представляет собой какой-либо операнд или тип данных.

Тип функции (или тип возвращаемых данных) - тип возвращаемого значения; имя функции - имя, по которому вызывается функция; аргументы ­ перечень аргументов, которые функция использует для своих действий; результат функции ­ переменная определяющее возвращаемое значение функции. Любые блоки операторов (в том числе и содержимое функции) выделяются фигурными скобками.

Если функция ничего не возвращает - то используется пустой тип void. Соответственно, в коде функции строка return() не нужна.

Для использование функции в другой части программы к ней производится обращение по ее имени: 
`<имя функции> (<аргументы, передаваемые функции>)`

Ниже представлен пример простой функции, выполняющей суммирование двух чисел:
```cpp
int sum( int a, int b ) // функция sum целочисленного типа int принимает два числа: a и b
{
  int result;    //явно указываем переменную, хранящую значение суммы
  result = a+b;  //присваиваем переменной значение суммы a и b
  return result; // возвращает результат их сложения
}
```

**В случае Arduino в программе обязательно должны быть две функции: setup и loop.** Пустая программа для Arduino выглядит так:
```cpp
void setup() {
  // put your setup code here, to run once:

}

void loop() {
  // put your main code here, to run repeatedly:

}
```

Содержимое функции setup выполняется сразу при включении или перезагрузке платы. Затем постоянно повторяясь выполняется функция loop.

Комментарии в программе позволяют вам оставить свои пометки (для себя или коллег). Комментирование кода - очень полезная привычка, особенно при написании больших программ в команде. Комментарий никак не влияет на компиляцию программы и служит только для хранения уточнений программиста. В ардуино можно комментировать строку (все, что записано после // - это комментарий). Или можно комментировать блок кода (комментарий между символами /* и */)

```cpp
void setup()
{
этот код работает // это комментарий
этот код работает 

/*
это тоже комментарий

*/

этот код работает 

}
```
В этом примере видно, где комментарий написан правильно (серым), а где посчитается за код.

Взглянем на функцию, которую вы запускали ранее еще раз с целью подробного разбора программного кода.
```cpp
#define LED_BUILTIN 27               //В этих строках задаются глобальные переменные, так программа будет знать, что при указании в коде LED_BUILTIN (имя может быть произвольным) - нужно подставить вместо него 27, что указывает на номер разъема, к которому подключен светодиод
#define input 26                     // Аналогично с кнопкой, она подключена к разъему с номером 26

int program(){                       // Создаем новую функцию с именем program
 digitalWrite(LED_BUILTIN, HIGH); // Эта функция включает светодиод. По факту происходит запись значения HIGH (что является логической единицей) в переменную LED_BUILTIN. Поскольку переменная ссылается на 27 разъем, то устройство фактически подает напряжение на него, что и включает светодиод.
 delay(1000);  // Функция ожидания, которая принимает на вход время в миллисекундах.
 digitalWrite(LED_BUILTIN, LOW);// При записи LOW на переменную разъема, на нем устанавливается напряжение 0 Вольт, то есть фактически выключается электропитание - диод гаснет.
 delay(1000); 
 return 0;                          // Поскольку функция типа Int, то она обязательно должна возвращать значение, в этом примере функция всегда возвращает 0, если функция не возвратила 0, то программа получит сообщение об ошибке
}


int buttonState = 0;                 // Переменная для хранения состояния кнопки

void setup() {                       // Обязательная функция setup
  pinMode(LED_BUILTIN, OUTPUT);      //конфигурация разъема к светодиоду как цифрового выхода
  pinMode(input, INPUT);             //конфигурация разъема, к которому подключена кнопка, как цифровой вход
}

void loop() {                       // Основная повторяемая функция
  buttonState = digitalRead(input); //Чтение значение кнопки и присвоение этого значения переменной buttonState
  if (buttonState == HIGH){         //Если кнопка нажата, в этом примере кнопка подключена к +5 Вольт, ее нажатие создаст на втором разъема такое же напряжение, то есть значение на этом разъеме установится в HIGH
    program();                      //Вызов описанной ранее функции program
    }
}
```
В этом коде появился еще не знакомый оператор `if`. Если в программе нужно выполнять разные команды в зависимости от условия (например, включить обогрев если температура ниже 20 градусов) - необходимо использовать оператор условия if.
![](https://ucarecdn.com/fde2c926-8ea9-48b0-9b8d-89e32ba42d4f/)

Оператор if позволяет проверять условие и в зависимости от результата выполнять различные блоки кода. Соответственно состоит из проверяемого условия, операторов выполняемых при выполнении условия и операторов, выполняемых в обратном случае.

Структура условия:
```
if ( <условие> )  { <оператор, выполняемый при верном условии> ; }

else {<оператор, выполняемый при НЕверном условии> ; }
```
 

Блок `else { }` можно опустить, он не обязателен.
Рассмотрим простой пример применения if-else:
```cpp
if (x<10) // условие (значение переменной x меньше 10)
 {y++;} // при выполнении условия значение y увеличится
else 
 {y--;} // если же условие неверно – то уменьшится 
 ```

 Такой оператор условия идеально подходит под задание практического занятия - управление светодиодом. Рассмотрим пример, при  нажатой кнопке необходимо увеличивать частоту мигания светодиодом.

```cpp
int led = 2; // 2й пин – светодиод
int key = 8; // 8й - кнопка
int time = 1000; // time – переменная для времени мигания

void setup() {                
  pinMode(led, OUTPUT);     
  pinMode(key, INPUT);     
}

void loop() {
  if (digitalRead(key)==HIGH) // если ключ нажат (сигнал = 5В)
	{time = 100;} // то время=100 мс.
 	else {time = 1000;} // иначе время=1000 мс.

  digitalWrite(led, HIGH);   
  delay(time);               
  digitalWrite(led, LOW);    
  delay(time);              
}
```

if-else поддерживает и вложенные условия, они выполняются последовательно. Но для таких случаев можно использовать и другие операторы C++. Например оператор выбора `switch`, который позволяет проверять значение переменной и выполнить одно из действий, в зависимости от значения переменной. Оператор используется тогда, когда в зависимости от значения переменной программа должна вести себя по разному (3 и более варианта поведения).

Структура кода с использованием `switch` показана ниже:
```cpp
switch ( <проверяемая переменная> )
  {
  case <значение переменной> :
    <оператор, выполняемый при совпадении значения> ;
    break; //описание break представлено ниже
  default:
    <оператор выполняемый, если ни одно значение не подошло> ;
    break;
  }
```
```cpp
switch (val) // проверяется переменная val
  {
  case 5:
    x+=100; // если val==5 то x+=100
    break;
  default:
    x+=10; // если ни одно условие не подошло – то  x+=10
    break;
  }
```
Стоит отметить особенность выполнения команд в `switch`:  Когда `case` совпал (или выполняется `default`), то выполнение начинается с первой команды, которая находится после соответствующего `case` и продолжается до тех пор, пока не будет выполнено одно из следующих условий завершения: достигнут конец блока `switch` или выполняется оператор прерывания блока кода `break/` `goto/` `return`. Если нет команды `break`, то выполняться будут все кейсы после того `case`, который совпал с выражением `switch`. 

Где этот оператор можно применить? Представим ситуацию, в которой нужно отображать разную индикацию при различных событиях. К примеру требуется контроль за температурой в определенном помещении. При температуре +4 градуса Цельсия и ниже индикации быть не должно, при +6 требуется включить один диод, при +8 второй, а при +10 и выше третий. В этом случае может использоваться оператор `switch`. 

Если упростить условие убрав датчик температуры, то в этом можно убедиться наглядно.
